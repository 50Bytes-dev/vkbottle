# Rules - Правила обработки

## Встроенные правила

Все встроенные правила обработки можно найти [здесь](/vkbottle/framework/rule/rule.py), они постоянно обновляются

Основными правилами являются:

| Правило        | Аргументы                              | Описание                                                             |
|:--------------:|:--------------------------------------:|:--------------------------------------------------------------------:|
| MessageRule    | str or List[str]                       | Правило на обычные сообщения                                         |
| VBMLRule       | str or Pattern or List[str or Pattern] | Правило на сообщения разметки вбмл                                   |
| ChatActionRule | str or List[str]                       | Правило на события беседы                                            |
| EventRule      | str or List[str]                       | Правило на события сообщества                                        |
| AttachmentRule | UnionMixin                             | Правило на вложение в сообщении                                      |
| StickerRule    | UnionMixin                             | Правило на стикер                                                    |
| PayloadRule    | dict, int                              | Правило на полезную нагрузку (1 мод - равенство, 2 мод - содержание) |

Основные правила можно использовать прямо из коробки

```python
from vkbottle.rule import StickerRule, AttachmentRule
# ...

@bot.on.chat_message(StickerRule())
async def sticker(ans: Message):
    return "ого... стикер"


@bot.on.message(AttachmentRule("audio"))
async def audio(ans: Message):
    return "ого... аудио"
```

## Создание правил

### Основа

Основой правил является класс `vkbottle.rule.AbstractRule` - он создает несколько объектов в себе при инициировании нового правила, наследованного от него:

| Объект               | Назначение                                                                                                    |
|:--------------------:|:-------------------------------------------------------------------------------------------------------------:|
| data: dict           | Является словарем хранения постоянных данных для правила                                                      |
| call                 | Хранит объект (функцию), вызываемый после прохождений правил                                                  |
| context: RuleExecute | Содержит в себе позиционные и непозиционные аргументы, которые будут переданы в хендлер после проверки правил |

Каждое правило (Rule) должно иметь 1 обязательную и 2 необязательных функции:

| Функция    | Обязательна | Назначение                                                                                                                                        |
|:----------:|:-----------:|:-------------------------------------------------------------------------------------------------------------------------------------------------:|
| `check`    | да          | Функция проверки правила, возвращает True, если правило пройдено                                                                                  |
| `__init__` | нет         | Функция инициализации правила, используется для кастомизации проверки                                                                             |
| `create`   | нет         | Вызывается при создании хендлера, обязательно передается функция хендлера в поле func, создается поле context. По умолчанию задано в AbstractRule |

### Создание

Создадим правило, которое будет проверять 

```python
from vkbottle.rule import AbstractRule
from vkbottle import Message

class MyFirstRule(AbstractRule):
    def __init__(self, count: int):
        self.data["c"] = count
    
    def check(self, message: Message):
        if len(message.text.split()) == self.data["c"]:
            return True
```

 При инициализации правило получает аргумент `count`, сохраняет его в словарь `data`

При проверке правило проверяет равно ли количество слов в сообщении, аргументу `count`, заданному ранее

### Использование

Любое созданное правило можно легко добавить в хендлер:

```python
@bot.on.message(MyFirstRule(3))
```

Если правил несколько, соответствие будет проверяться поочередно

Аргументы из всех правил для хендлера (`context`) складываются тоже поочередно

## Новые хендлеры

```python
# Простые хендлеры для правил
@bot.on.message.rule(*rules)
@bot.on.chat_message.rule(*rules)
```

```python
# Хендлеры одного правила для ивентов (особенность обработки ивентов)
@bot.on.event.rule(rule)
```


